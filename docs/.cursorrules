# Voice AI Loan Pre-Approval Demo - AI Rules

## Project Flow (Critical)
1. Twilio call → POST / → TwiML with WebSocket URL
2. WebSocket /ws → Pipecat pipeline (Deepgram STT → OpenAI LLM → OpenAI TTS)
3. Agent collects: name, phone, zip_code (in order)
4. Generate secure link → Send via SMS/Email
5. User completes form → POST /loan-application
6. Credit check (dummy) → DecisionRules evaluation → Result display
7. Escalate to human if edge case/high risk

## Key Files
- `main.py`: FastAPI server, webhooks, WebSocket, form endpoints
- `bot.py`: Pipecat voice pipeline, conversation management
- `templates/loan_application.html`: Form with pre-fill from URL params
- `static/js/loan_application.js`: Form pre-fill logic

## Critical Implementation Details
- WebSocket URL: Auto-generated from headers if WEBSOCKET_URL not set
- LLM system prompt in `bot.py` defines: greeting → consent → data collection → link handoff
- Form pre-fills: legal_name, phone, zip_code from URL query params
- DecisionRules: https://api.decisionrules.io, solver_key required, rule_alias="loan-approval"
- Credit score: Currently dummy, needs real integration
- Email: MailerSend for secure link delivery (https://www.npmjs.com/package/mailersend)

## Tech Stack
FastAPI, Pipecat (https://reference-server.pipecat.ai/en/latest/), Twilio (webhooks), MailerSend (email), DecisionRules (https://docs.decisionrules.io/doc)

## Environment Variables
TWILIO_ACCOUNT_SID, TWILIO_AUTH_TOKEN, DEEPGRAM_API_KEY, OPENAI_API_KEY, ELEVENLABS_API_KEY, MAILERSEND_API_KEY, DECISIONRULES_SOLVER_KEY, WEBSOCKET_URL (optional)

## Constraints
- Soft credit inquiry (must explain to user)
- Explicit consent required before credit check
- Secure links must expire (24h default)
- HTTPS/WSS required in production
- **In-memory storage only** - No database, data lost on restart

